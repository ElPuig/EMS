<odoo>
    <data>
        <record model="ir.ui.view" id="view_subject_form">
            <field name="name">ims.subject.form</field>
            <field name="model">ims.subject</field>
            <field name="arch" type="xml">				
                <form string="subject">                   
                    <sheet>                        
                        <group string="Main data" col="4">
                            <group colspan="4">
                                <field name="subject_id" attrs="{'invisible':[('level', '==', 1)]}"/>
                                
                                <!-- Needed but hidden for filtering purposes -->
                                <field name="level" invisible="1"/>   
                                <field name="last" invisible="1"/>                                                                          
                            </group>
                            <group>
                                <field name="code"/>
                                <field name="total_hours" />
                            </group>
                            <group>							
                                <field name="acronym"/>
                                <field string="Internal hours" name="total_internal_hours" attrs="{'invisible':['|', ('last', '==', True), ('total_internal_hours', '==', 0)]}"/>
                                <field name="internal_hours" attrs="{'invisible':[('last', '==', False), ('total_internal_hours', '!=', 0)]}"/>
                            </group>  
                            <group colspan="2">
                                <group colspan="2">
                                    <field name="name"/>
                                </group>    
                                 <group>			
                                    <field string="External hours" name="total_external_hours" attrs="{'invisible':['|', ('last', '==', True), ('total_external_hours', '==', 0)]}"/>
                                    <field name="external_hours" attrs="{'invisible':[('last', '==', False), ('total_external_hours', '!=', 0)]}"/>
                                </group>                                
                                <group>                        
                                    <field name="ects" attrs="{'invisible':[('subject_id', '!=', False)]}"/>                                    
                                </group>
                            </group>                                                                                                                               
                        </group>
                        
                        <notebook>    
                            <page string="Studies" attrs="{'invisible':[('level', '>', 1)]}">
                                <field name="study_ids" widget="one2many" >
                                    <tree editable="bottom" default_order="code asc, acronym asc, name asc">
                                        <field name="code"/>
                                        <field name="acronym"/>
                                        <field name="name"/>
                                        <button class="oe_stat_button" title="Edit Study" icon="fa-pencil-square-o" name="open_form_study" type="object" />
                                    </tree>
                                </field>
                            </page>

                            <page string="Composite">
                                <field name="subject_ids" widget="one2many" context="{'default_subject_id': id, 'default_study_ids': study_ids, 'default_level': level+1}">
                                    <tree editable="bottom" default_order="code asc, acronym asc, name asc">
                                        <field name="code"/>
                                        <field name="acronym"/>
                                        <field name="name"/>
                                        <button class="oe_stat_button" title="Edit Subject" icon="fa-pencil-square-o" name="open_form_subject" type="object" />

                                        <!-- Needed but hidden for filtering purposes -->
                                        <field name="subject_id" invisible="1"/>
                                        <field name="level"  invisible="1"/>
                                        <field name="study_ids" invisible="1"/>
                                    </tree>
                                </field>
                            </page>

                            <page string="Criteria" attrs="{'invisible':[('level', '==', 1)]}">
                                <field name="criteria_ids" widget="one2many" context="{'default_subject_id': id}">
                                    <tree editable="bottom" default_order="acronym asc, name asc">
                                        <field name="acronym"/>
                                        <field name="name"/>    
                                        <button class="oe_stat_button" title="Edit Criteria" icon="fa-pencil-square-o" name="open_form_criteria" type="object" />                                    

                                        <!-- Needed but hidden for filtering purposes -->
                                        <field name="subject_id" invisible="1"/>                                                                                
                                    </tree>
                                </field>
                            </page>

                            <page string="Content" attrs="{'invisible':[('level', '!=', 1)]}">
                                <field name="content_ids" widget="one2many" context="{'default_subject_id': id}">                                
                                    <tree editable="bottom" default_order="code asc, level asc, acronym asc"
                                        decoration-bf="level==1" decoration-muted="level==2" decoration-it="level>=3">
                                        <field name="code"/>
                                        <field name="acronym"/>
                                        <field name="name"/>                                            
                                        <button class="oe_stat_button" title="Edit Content" icon="fa-pencil-square-o" name="open_form_content" type="object" />                                 

                                        <!-- Needed but hidden for filtering purposes -->
                                        <field name="subject_id" invisible="1"/>
                                        <field name="level" invisible="1"/>
                                    </tree>
                                </field>
                            </page>
                            
                            <page string="Notes">
                                <field name="notes" placeholder="Write down here your notes..."/>
                            </page>
                        </notebook>
                    </sheet>	
                </form>
            </field>			
        </record>
    </data>
</odoo>